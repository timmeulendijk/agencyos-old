services:

  # DIRECTUS
  directus:
    image: directus/directus:latest
    container_name: directus
    restart: always
    env_file:
      - .env
    ports:
      - '8055:8055'
    volumes:
      - ./uploads:/directus/uploads
      - ./extensions:/directus/extensions
      - ./templates:/directus/templates
      - ./run-scripts:/directus/run-scripts  
    networks:
      - webproxy  
    environment:
      KEY: ${DIRECTUS_KEY}
      SECRET: ${DIRECTUS_SECRET}

      # Database settings
      DB_CLIENT: ${SUPABASE_DB_CLIENT}
      DB_HOST: ${SUPABASE_DB_HOST}
      DB_PORT: ${SUPABASE_DB_PORT}
      DB_DATABASE: ${SUPABASE_DB_DATABASE}
      DB_USER: ${SUPABASE_DB_USER}
      DB_PASSWORD: ${SUPABASE_DB_PASSWORD}

      # Directus settings
      ADMIN_EMAIL: ${DIRECTUS_ADMIN_EMAIL}
      ADMIN_PASSWORD: ${DIRECTUS_ADMIN_PASSWORD}
      PUBLIC_URL: ${DIRECTUS_PUBLIC_URL}

      # CORS settings for production
      # CORS_ENABLED: 'true'
      # CORS_ORIGIN: 'https://2kingsdesign.nl,https://www.2kingsdesign.nl'
      # CORS_METHODS: 'GET,POST,PATCH,DELETE'
      # CORS_ALLOWED_HEADERS: 'Content-Type,Authorization'
      # CORS_EXPOSED_HEADERS: 'Content-Range'
      # CORS_CREDENTIALS: 'true'
      # CORS_MAX_AGE: '18000'

      # These is helpful for local developement but should probably be removed in production
      # CORS_ENABLED: 'true'
      # REFRESH_TOKEN_COOKIE_DOMAIN: 'localhost'
      # EXTENSIONS_AUTO_RELOAD: 'true'
      # WEBSOCKETS_ENABLED: 'true'

networks:
  webproxy:
    driver: bridge
    external: 'false'

# NGINX WITH SSL
# nginx:
#   image: nginx:latest
#   container_name: nginx_ssl
#   restart: unless-stopped
#   ports:
#     - "8080:80"
#     - "443:443"
#   volumes:
#     - ./../nginx/config/nginx.conf:/etc/nginx/nginx.conf
#   networks:
#     - webproxy
#   depends_on:
#     - directus