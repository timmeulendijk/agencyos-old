import{u as g}from"./Bf5SMuIn.js";import{D as y,$ as E,e as P}from"./C1Qq1QLd.js";var w="https://js.stripe.com/v3",b=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,m="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",L=function(){for(var r=document.querySelectorAll('script[src^="'.concat(w,'"]')),e=0;e<r.length;e++){var t=r[e];if(b.test(t.src))return t}return null},v=function(r){var e="",t=document.createElement("script");t.src="".concat(w).concat(e);var n=document.head||document.body;if(!n)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(t),t},j=function(r,e){!r||!r._registerWrapper||r._registerWrapper({name:"stripe-js",version:"4.0.0",startTime:e})},u=null,l=null,d=null,C=function(r){return function(){r(new Error("Failed to load Stripe.js"))}},T=function(r,e){return function(){window.Stripe?r(window.Stripe):e(new Error("Stripe.js not available"))}},x=function(r){return u!==null?u:(u=new Promise(function(e,t){if(typeof window>"u"||typeof document>"u"){e(null);return}if(window.Stripe&&r&&console.warn(m),window.Stripe){e(window.Stripe);return}try{var n=L();if(n&&r)console.warn(m);else if(!n)n=v(r);else if(n&&d!==null&&l!==null){var i;n.removeEventListener("load",d),n.removeEventListener("error",l),(i=n.parentNode)===null||i===void 0||i.removeChild(n),n=v(r)}d=T(e,t),l=C(t),n.addEventListener("load",d),n.addEventListener("error",l)}catch(s){t(s);return}}),u.catch(function(e){return u=null,Promise.reject(e)}))},A=function(r,e,t){if(r===null)return null;var n=r.apply(void 0,e);return j(n,t),n},c,S=!1,h=function(){return c||(c=x(null).catch(function(r){return c=null,Promise.reject(r)}),c)};Promise.resolve().then(function(){return h()}).catch(function(o){S||console.warn(o)});var O=function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];S=!0;var n=Date.now();return h().then(function(i){return A(i,e,n)})};let p;const R=o=>(p||(p=O(o)),p);function k(){const o=g(),r=E(),{stripePublishableKey:e}=r.public,t=y(!1),n=async s=>{t.value=!0;try{const a=await $fetch("/api/stripe/create-checkout-session",{method:"POST",body:{invoiceId:s}}),f=await R(e);if(!f)throw P("Problem loading payment processor");const{error:$}=await f.redirectToCheckout({sessionId:a.id})}catch(a){o.add({id:"stripe-checkout-error",title:"Oops! Something went wrong.",description:a.data.message??"An unexpected error occurred.",color:"red",icon:"material-symbols:warning-outline-rounded"})}finally{t.value=!1}};async function i(s){t.value=!0;try{const a=await $fetch("/api/stripe/create-portal-link",{method:"POST",body:{customerId:s}});window.location.href=a.url}catch(a){o.add({id:"stripe-portal-error",title:"Oops! Something went wrong.",description:a.data.message??"An unexpected error occurred.",color:"red",icon:"material-symbols:warning-outline-rounded"})}}return{loading:t,handleCheckout:n,getPortalLink:i}}export{k as u};
